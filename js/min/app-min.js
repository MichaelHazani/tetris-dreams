"use strict";$(function(){Physijs.scripts.worker="./js/physijs_worker.js",Physijs.scripts.ammo="./ammo.js";var e,t,n,o,a,i,r,s,c,d,l,E,u,m,w,h,p,T,R,M,f,k,H,v,L,b,g=new THREE.Raycaster,y=new THREE.Vector2,j=window.innerWidth,x=window.innerHeight,P=!1,z=!1,B=!1,S=!1,q=!1,F=!1,O=performance.now(),C=new THREE.Vector3,W=200,A=0,V=50,J=1e3,N="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;if(N){var _=document.body,I=function(e){document.pointerLockElement===_||document.mozPointerLockElement===_||document.webkitPointerLockElement===_?(P=!0,k.enabled=!0):k.enabled=!1},G=function(e){};document.addEventListener("pointerlockchange",I,!1),document.addEventListener("mozpointerlockchange",I,!1),document.addEventListener("webkitpointerlockchange",I,!1),document.addEventListener("pointerlockerror",G,!1),document.addEventListener("mozpointerlockerror",G,!1),document.addEventListener("webkitpointerlockerror",G,!1),document.body.addEventListener("click",function(e){if(_.requestPointerLock=_.requestPointerLock||_.mozRequestPointerLock||_.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var t=function(e){(document.fullscreenElement===_||document.mozFullscreenElement===_||document.mozFullScreenElement===_)&&(document.removeEventListener("fullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),_.requestPointerLock())};document.addEventListener("fullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),_.requestFullscreen=_.requestFullscreen||_.mozRequestFullscreen||_.mozRequestFullScreen||_.webkitRequestFullscreen,_.requestFullscreen()}else _.requestPointerLock()},!1)}else document.body.innerHTML="Your browser doesn't seem to support Pointer Lock API";e=function(){function e(){a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight)}function i(e){y.x=e.clientX/window.innerWidth*2-1,y.y=2*-(e.clientY/window.innerHeight)+1}function s(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/R-shape.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:16724736}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}function d(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/cube.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:128}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}function E(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/squiggly.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:32896}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}function m(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/pedestal.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:13789470}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}function h(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/longline.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:8388608}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}M=new THREE.Clock,n=new THREE.WebGLRenderer({antialias:!0}),n.setSize(window.innerWidth,window.innerHeight),n.setClearColor(16777215),document.body.appendChild(n.domElement),o=new Physijs.Scene,a=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,1e3),a.position.set(0,0,10),o.add(a),k=new THREE.PointerLockControls(a),o.add(k.getObject());var T=function(e){switch(e.keyCode){case 38:case 87:e.preventDefault(),z=!0;break;case 37:case 65:S=!0;break;case 40:case 83:B=!0;break;case 39:case 68:q=!0;break;case 32:F===!0&&(C.y+=200),F=!1}},f=function(e){switch(e.keyCode){case 38:case 87:z=!1;break;case 37:case 65:S=!1;break;case 40:case 83:B=!1;break;case 39:case 68:q=!1}};document.addEventListener("keydown",T,!1),document.addEventListener("keyup",f,!1),window.addEventListener("resize",e,!1),c=l=u=w=p=new THREE.JSONLoader;var v=setInterval(function(){function e(e){switch(e){case 1:s();break;case 2:d();break;case 3:E();break;case 4:m();break;case 5:h()}}var t=Math.round(5*Math.random())+1;e(t%3==0?1:t%4==0?2:t%5==0?3:t%2==0?4:5),A++,A>=V&&clearInterval(v)},J),L=new THREE.TextureLoader,b=L.load("../images/checkers.gif");b.wrapS=THREE.RepeatWrapping,b.wrapt=THREE.RepeatWrapping,b.repeat.set(.01,.01),R=new Physijs.BoxMesh(new THREE.BoxGeometry(1e3,1,1e3),new THREE.MeshLambertMaterial({map:b}),0),R.rotation.x=Math.PI,R.position.set(0,-2,0),o.add(R),r=new THREE.PointLight(16777215,1),r.position.set(0,17,0),o.add(r);var P=new THREE.AmbientLight(16777215,.5);o.add(P),requestAnimationFrame(t);var O=new THREE.BoxGeometry(700,700,700),N=[],L=new THREE.TextureLoader;N.push(new THREE.MeshBasicMaterial({map:L.load("../images/sides.jpg"),side:THREE.BackSide}));var L=new THREE.TextureLoader;N.push(new THREE.MeshBasicMaterial({map:L.load("../images/sides.jpg"),side:THREE.BackSide}));var L=new THREE.TextureLoader;N.push(new THREE.MeshBasicMaterial({map:L.load("../images/top.jpg"),side:THREE.BackSide}));var L=new THREE.TextureLoader;N.push(new THREE.MeshBasicMaterial({map:L.load("../images/bottom.jpg"),side:THREE.BackSide}));var L=new THREE.TextureLoader;N.push(new THREE.MeshBasicMaterial({map:L.load("../images/sides.jpg"),side:THREE.BackSide}));var L=new THREE.TextureLoader;N.push(new THREE.MeshBasicMaterial({map:L.load("../images/sides.jpg"),side:THREE.BackSide}));var _=new THREE.MeshFaceMaterial(N),I=new THREE.Mesh(O,_);I.position.y=140,o.add(I);var G=new THREE.BokehPass(o,a,{focus:1,aperture:.09,maxblur:1.4,width:j,height:x});G.renderToScreen=!0,H=new THREE.EffectComposer(n),H.addPass(new THREE.RenderPass(o,a)),H.addPass(G),a.lookAt(new THREE.Vector3(0,100,-100)),window.addEventListener("mousemove",i,!1),window.addEventListener("click",function(){g.setFromCamera(y,a);for(var e=g.intersectObjects(o.children),t=0;t<e.length;t++)console.log(e[t].object),e[t].object.__dirtyPosition=!0,e[t].object.__dirtyRotation=!0,e[t].object.material.color.set(65280),e[t].object.setLinearVelocity(new THREE.Vector3(0,0,0)),e[t].object.setAngularVelocity(new THREE.Vector3(0,0,0))},!1)},t=function(){if(P){var e=performance.now(),i=(e-O)/500;C.x-=10*C.x*i,C.z-=10*C.z*i,C.y-=9.8*100*i,z&&(C.z-=400*i),B&&(C.z+=400*i),S&&(C.x-=400*i),q&&(C.x+=400*i),k.getObject().translateX(C.x*i),k.getObject().translateY(C.y*i),k.getObject().translateZ(C.z*i),k.getObject().position.y<10&&(C.y=0,k.getObject().position.y=10,F=!1),O=e,n.render(o,a)}o.simulate(),requestAnimationFrame(t),H.render()},e()});