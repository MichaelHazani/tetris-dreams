"use strict";$(function(){Physijs.scripts.worker="./js/physijs_worker.js",Physijs.scripts.ammo="./ammo.js";var e,t,n,o,a,i,r,s,c,d,l,E,u,m,h,w,p,T,R,f,M,H,k,v,g,y,L=new THREE.Raycaster,b=new THREE.Vector2,x=window.innerWidth,j=window.innerHeight,P=!1,z=!1,B=!1,S=!1,q=!1,O=!1,F=performance.now(),C=new THREE.Vector3,W=200,V=[],A=0,J=50,N=1e3,_="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;if(_){var G=document.body,I=function(e){document.pointerLockElement===G||document.mozPointerLockElement===G||document.webkitPointerLockElement===G?(P=!0,H.enabled=!0):H.enabled=!1},Y=function(e){};document.addEventListener("pointerlockchange",I,!1),document.addEventListener("mozpointerlockchange",I,!1),document.addEventListener("webkitpointerlockchange",I,!1),document.addEventListener("pointerlockerror",Y,!1),document.addEventListener("mozpointerlockerror",Y,!1),document.addEventListener("webkitpointerlockerror",Y,!1),document.body.addEventListener("click",function(e){if(G.requestPointerLock=G.requestPointerLock||G.mozRequestPointerLock||G.webkitRequestPointerLock,/Firefox/i.test(navigator.userAgent)){var t=function(e){(document.fullscreenElement===G||document.mozFullscreenElement===G||document.mozFullScreenElement===G)&&(document.removeEventListener("fullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),G.requestPointerLock())};document.addEventListener("fullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),G.requestFullscreen=G.requestFullscreen||G.mozRequestFullscreen||G.mozRequestFullScreen||G.webkitRequestFullscreen,G.requestFullscreen()}else G.requestPointerLock()},!1)}else document.body.innerHTML="Your browser doesn't seem to support Pointer Lock API";e=function(){function e(){a.aspect=window.innerWidth/window.innerHeight,a.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight),$(".chair")[0].style.top=window.innerHeight/2+"px",$(".chair")[0].style.left=window.innerWidth/2+"px"}function i(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/R-shape.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:16724736}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}function s(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/cube.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:128}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}function d(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/squiggly.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:32896}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}function E(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/pedestal.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:13789470}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}function m(){setTimeout(function(){var e=Math.floor(Math.random()*W+1),t=Math.floor(Math.random()*W+1);p.load("./JSON/longline.json",function(n){var a=new Physijs.BoxMesh(n,new THREE.MeshLambertMaterial({color:8388608}));a.scale.set(2,2,2),a.position.y=100,a.position.x=e,a.position.z=t,a.rotation.x=e,a.rotation.y=t,a.rotation.z=e,o.add(a)})},2e3)}f=new THREE.Clock,n=new THREE.WebGLRenderer({antialias:!0}),n.setSize(window.innerWidth,window.innerHeight),n.setClearColor(16777215),document.body.appendChild(n.domElement),o=new Physijs.Scene,o.setGravity(new THREE.Vector3(0,-50,0)),a=new THREE.PerspectiveCamera(35,window.innerWidth/window.innerHeight,1,1e3),a.position.set(0,0,10),o.add(a),H=new THREE.PointerLockControls(a),o.add(H.getObject()),$(".chair")[0].style.top=window.innerHeight/2+"px",$(".chair")[0].style.left=window.innerWidth/2+"px";var w=function(e){switch(e.keyCode){case 38:case 87:e.preventDefault(),z=!0;break;case 37:case 65:S=!0;break;case 40:case 83:B=!0;break;case 39:case 68:q=!0;break;case 32:O===!0&&(C.y+=200),O=!1}},T=function(e){switch(e.keyCode){case 38:case 87:z=!1;break;case 37:case 65:S=!1;break;case 40:case 83:B=!1;break;case 39:case 68:q=!1}};document.addEventListener("keydown",w,!1),document.addEventListener("keyup",T,!1),window.addEventListener("resize",e,!1),c=l=u=h=p=new THREE.JSONLoader;var M=setInterval(function(){function e(e){switch(e){case 1:i();break;case 2:s();break;case 3:d();break;case 4:E();break;case 5:m()}}var t=Math.round(5*Math.random())+1;e(t%3==0?1:t%4==0?2:t%5==0?3:t%2==0?4:5),A++,A>=J&&clearInterval(M)},N),v=new THREE.TextureLoader,g=v.load("../images/checkers.gif");g.wrapS=THREE.RepeatWrapping,g.wrapt=THREE.RepeatWrapping,g.repeat.set(.01,.01),R=new Physijs.BoxMesh(new THREE.BoxGeometry(1e3,1,1e3),new THREE.MeshLambertMaterial({map:g}),0),R.rotation.x=Math.PI,R.position.set(0,-2,0),R.name="plane",o.add(R),r=new THREE.PointLight(16777215,1),r.position.set(0,17,0),o.add(r);var y=new THREE.AmbientLight(16777215,.5);o.add(y),requestAnimationFrame(t);var b=new THREE.BoxGeometry(700,700,700),P=[],v=new THREE.TextureLoader;P.push(new THREE.MeshBasicMaterial({map:v.load("../images/sides.jpg"),side:THREE.BackSide}));var v=new THREE.TextureLoader;P.push(new THREE.MeshBasicMaterial({map:v.load("../images/sides.jpg"),side:THREE.BackSide}));var v=new THREE.TextureLoader;P.push(new THREE.MeshBasicMaterial({map:v.load("../images/top.jpg"),side:THREE.BackSide}));var v=new THREE.TextureLoader;P.push(new THREE.MeshBasicMaterial({map:v.load("../images/bottom.jpg"),side:THREE.BackSide}));var v=new THREE.TextureLoader;P.push(new THREE.MeshBasicMaterial({map:v.load("../images/sides.jpg"),side:THREE.BackSide}));var v=new THREE.TextureLoader;P.push(new THREE.MeshBasicMaterial({map:v.load("../images/sides.jpg"),side:THREE.BackSide}));var F=new THREE.MeshFaceMaterial(P),_=new THREE.Mesh(b,F);_.position.y=140,o.add(_);var G=new THREE.BokehPass(o,a,{focus:1,aperture:.09,maxblur:1.4,width:x,height:j});G.renderToScreen=!0,k=new THREE.EffectComposer(n),k.addPass(new THREE.RenderPass(o,a)),k.addPass(G),a.lookAt(new THREE.Vector3(0,100,-100)),document.addEventListener("mousedown",function(){var e=new THREE.Vector2;e.x=0,e.y=0,L.setFromCamera(e,a);for(var t=L.intersectObjects(o.children),n=0;n<t.length;n++)"plane"!=t[n].object.name&&(t[n].object.material.color.set(65280),V.push(t[n].object));console.log(H.getObject().position)},!1)},t=function(){if(P){var e=performance.now(),n=(e-F)/500;C.x-=10*C.x*n,C.z-=10*C.z*n,C.y-=9.8*100*n,z&&(C.z-=400*n),B&&(C.z+=400*n),S&&(C.x-=400*n),q&&(C.x+=400*n),H.getObject().translateX(C.x*n),H.getObject().translateY(C.y*n),H.getObject().translateZ(C.z*n),H.getObject().position.y<10&&(C.y=0,H.getObject().position.y=10),F=e}V.length>0&&V.forEach(function(e){e.setLinearVelocity(new THREE.Vector3(0,0,0)),e.setAngularVelocity(new THREE.Vector3(0,0,0)),e.__dirtyPosition=!0,e.__dirtyRotation=!0}),requestAnimationFrame(t),o.simulate(),k.render()},e()});